const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SettingsModal.js","assets/storage.js"])))=>i.map(i=>d[i]);
var ne=Object.defineProperty;var ae=(v,e,t)=>e in v?ne(v,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):v[e]=t;var p=(v,e,t)=>ae(v,typeof e!="symbol"?e+"":e,t);import"./main.js";import{S as b}from"./storage.js";const oe="modulepreload",re=function(v){return"/"+v},X={},ce=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=re(c),c in X)return;X[c]=!0;const h=c.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const d=document.createElement("link");if(d.rel=h?"stylesheet":oe,h||(d.as="script"),d.crossOrigin="",d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),h)return new Promise((f,T)=>{d.addEventListener("load",f),d.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return i.then(n=>{for(const a of n||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};class de{constructor(e){this.container=e}render(e,t,r,i){var s,n;this.container.innerHTML=`
      <div class="zen-header">
        <div class="left">
          <span class="logo">‚òØ ZenTask</span>
        </div>
        <div class="center">
          <span class="status-text">${e}</span>
        </div>
        <div class="right" style="display:flex;gap:4px;">
          <button id="sound-toggle" class="icon-btn" title="${t?"Mute":"Unmute"}">${t?"üîä":"üîá"}</button>
          <button id="settings-btn" class="icon-btn" title="Settings">‚ò∞</button>
        </div>
      </div>
    `,(s=this.container.querySelector("#sound-toggle"))==null||s.addEventListener("click",r),(n=this.container.querySelector("#settings-btn"))==null||n.addEventListener("click",i)}}class ee{constructor(e){p(this,"ctx");p(this,"animationId",0);p(this,"state",null);p(this,"settings",null);p(this,"theme","forest");p(this,"phase",0);p(this,"currentSpeedMult",1);p(this,"currentAlphaMult",1);p(this,"TRANSITION_LERP",.05);p(this,"particles",[]);p(this,"ripples",[]);p(this,"mouse",{x:0,y:0,active:!1});p(this,"prefersReducedMotion",!1);p(this,"animate",()=>{this.render(),this.animationId=requestAnimationFrame(this.animate)});this.canvas=e,this.ctx=e.getContext("2d"),this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.initParticles()}start(){this.animate()}stop(){cancelAnimationFrame(this.animationId)}updateState(e,t){this.state=e,this.settings=t,this.theme!==t.theme&&(this.theme=t.theme,this.initParticles())}updateMouse(e,t){var r;this.prefersReducedMotion||!((r=this.settings)!=null&&r.backgroundInteractions)||(this.mouse.x=e,this.mouse.y=t,this.mouse.active=!0,this.theme==="rain"&&Math.random()>.8&&this.ripples.push({x:e,y:t,r:0,life:1}))}initParticles(){this.particles=[];const e=this.theme==="space"?80:40,t=this.canvas.width,r=this.canvas.height;for(let i=0;i<e;i++)this.particles.push({x:Math.random()*t,y:Math.random()*r,r:Math.random()*2+.5,vx:(Math.random()-.5)*.2,vy:(Math.random()-.5)*.2,baseDist:Math.random()*100+40,angle:Math.random()*Math.PI*2,opacity:Math.random()*.5+.2})}render(){var d,f,T;if(!this.canvas)return;const e=this.canvas.width,t=this.canvas.height,r=e/2,i=t/2;this.ctx.clearRect(0,0,e,t);const n={forest:{r:90,g:180,b:110},rain:{r:100,g:170,b:230},summer:{r:240,g:190,b:100},space:{r:150,g:100,b:240}}[this.theme];let a=1,c=1;(d=this.state)!=null&&d.isRunning&&(a=this.state.mode==="focus"?1.5:.8,c=this.state.mode==="focus"?1.2:.6),(f=this.settings)!=null&&f.backgroundTransitions?(this.currentSpeedMult+=(a-this.currentSpeedMult)*this.TRANSITION_LERP,this.currentAlphaMult+=(c-this.currentAlphaMult)*this.TRANSITION_LERP):(this.currentSpeedMult=a,this.currentAlphaMult=c);const h=.015*this.currentSpeedMult;this.prefersReducedMotion||(this.phase+=h),this.drawCore(r,i,n,this.currentAlphaMult),this.theme==="rain"&&(this.ripples=this.ripples.filter(l=>l.life>0),this.ripples.forEach(l=>{l.r+=2,l.life-=.02,this.ctx.strokeStyle=`rgba(${n.r}, ${n.g}, ${n.b}, ${l.life*.4})`,this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(l.x,l.y,l.r,0,Math.PI*2),this.ctx.stroke()}));const m=((T=this.settings)==null?void 0:T.backgroundInteractions)&&!this.prefersReducedMotion;this.particles.forEach(l=>{l.x+=l.vx*this.currentSpeedMult,l.y+=l.vy*this.currentSpeedMult,l.x<0&&(l.x=e),l.x>e&&(l.x=0),l.y<0&&(l.y=t),l.y>t&&(l.y=0);let x=l.x,E=l.y;if(m){const L=this.mouse.x-l.x,I=this.mouse.y-l.y,S=Math.sqrt(L*L+I*I);if(this.theme==="space"){if(S<150){const $=(150-S)*.05;x-=L/S*$,E-=I/S*$}}else this.theme==="forest"?(x+=(this.mouse.x-r)*.02*l.r,E+=(this.mouse.y-i)*.02*l.r):this.theme==="summer"&&S<100&&(l.vx+=(Math.random()-.5)*.1,l.vy-=.05)}const q=(l.opacity||.5)*this.currentAlphaMult;this.ctx.fillStyle=`rgba(${n.r}, ${n.g}, ${n.b}, ${q})`,this.ctx.beginPath(),this.ctx.arc(x,E,l.r,0,Math.PI*2),this.ctx.fill()})}drawCore(e,t,r,i){const s=90+Math.sin(this.phase)*12,n=this.mouse.active?(this.mouse.x-e)*.05:0,a=this.mouse.active?(this.mouse.y-t)*.05:0,c=this.ctx.createRadialGradient(e+n,t+a,0,e+n,t+a,s*2.5);c.addColorStop(0,`rgba(${r.r}, ${r.g}, ${r.b}, ${.15*i})`),c.addColorStop(1,"rgba(0,0,0,0)"),this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.arc(e+n,t+a,s*2.5,0,Math.PI*2),this.ctx.fill()}}class le{constructor(e){p(this,"visualizer",null);this.container=e}render(e,t,r,i,s,n){var h;const a=Math.floor(e.remainingSeconds/60).toString().padStart(2,"0"),c=(e.remainingSeconds%60).toString().padStart(2,"0");if(this.container.querySelector(".timer-container")){const m=this.container.querySelector("#time-display");m&&(m.textContent=`${a}:${c}`,m.classList.remove("focus-glow","break-glow"),e.isRunning&&e.mode==="focus"?m.classList.add("focus-glow"):e.isRunning&&m.classList.add("break-glow"));const d=this.container.querySelector("#status-text");d&&(d.textContent=this.getStatusText(e))}else{this.container.innerHTML=`
        <div class="timer-container" style="position:relative; width:300px; height:300px; cursor: pointer;">
          <canvas id="zen-visualizer" width="300" height="300"
                  style="position:absolute; top:0; left:0; z-index:0; border-radius:50%; pointer-events:none;"></canvas>

          <div style="position:relative; z-index:1; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;">
            <div class="timer-time" id="time-display">${a}:${c}</div>

            <div class="timer-controls">
              <button id="main-action-btn" class="btn-primary">
                ${e.isRunning?"Pause":"Start Focus"}
              </button>
              <button id="skip-btn" class="btn-secondary" style="padding:10px 14px;">‚è≠</button>
            </div>

            <div class="status-indicator" id="status-text">${this.getStatusText(e)}</div>
          </div>
        </div>
      `;const m=this.container.querySelector("canvas");m&&(this.visualizer=new ee(m),this.visualizer.start()),(h=this.container.querySelector(".timer-container"))==null||h.addEventListener("click",d=>{d.target.tagName.toLowerCase()!=="button"&&n()})}this.bindButton("#main-action-btn",e.isRunning?"Pause":"Start Focus",m=>{m.stopPropagation(),e.isRunning?i():r()}),this.bindButton("#skip-btn",void 0,m=>{m.stopPropagation(),s()}),this.visualizer&&this.visualizer.updateState(e,t)}getStatusText(e){return e.mode==="focus"?`Focus ¬∑ Cycle ${e.cyclesCompleted+1}`:e.mode==="break"?"Short Break":e.mode==="longBreak"?"Long Rest":"Ready"}bindButton(e,t,r){var n;const i=this.container.querySelector(e);if(!i)return;t!==void 0&&(i.textContent=t);const s=i.cloneNode(!0);(n=i.parentNode)==null||n.replaceChild(s,i),s.addEventListener("click",r)}}class J{constructor(e){this.container=e}render(e,t,r,i,s,n){const a=[...e].sort((d,f)=>d.id===t?-1:f.id===t?1:(d.order||0)-(f.order||0));this.container.innerHTML=`
      <div class="task-list-panel">
        <div class="tasks-header">
            <span>Today's Cycle</span>
            <span style="font-size:0.8em;opacity:0.7">${e.filter(d=>d.isCompleted).length}/${e.length}</span>
        </div>

        <div class="task-list">
          ${a.length===0?'<div class="empty-state">Focus on one thing at a time.</div>':a.map(d=>this.renderTaskRow(d,t)).join("")}
        </div>
        
        <div class="task-input-container">
            <input type="text" id="new-task-input" class="task-input" placeholder="What is your next focus?" />
            <button id="add-task-btn" class="btn-secondary" style="padding:10px 16px;">+</button>
        </div>
      </div>
    `;const c=this.container.querySelector("#new-task-input"),h=this.container.querySelector("#add-task-btn"),m=()=>{c.value.trim()&&(r(c.value.trim()),c.value="")};h==null||h.addEventListener("click",m),c==null||c.addEventListener("keypress",d=>{d.key==="Enter"&&m()}),this.container.querySelectorAll(".task-item").forEach(d=>{var T,l;const f=d.dataset.id;(T=d.querySelector(".task-checkbox"))==null||T.addEventListener("click",x=>{x.stopPropagation(),i(f)}),(l=d.querySelector(".delete-task-btn"))==null||l.addEventListener("click",x=>{x.stopPropagation(),n(f)}),d.addEventListener("click",()=>{!d.classList.contains("completed")&&f!==t&&s(f)})})}renderTaskRow(e,t){const r=e.id===t,i=e.isCompleted,s=Math.floor((e.totalTimeMs||0)/6e4),n=s>0?`${Math.floor(s/60)}h ${s%60}m`:"";return`
        <div class="task-item ${r?"active":""} ${i?"completed":""}" data-id="${e.id}">
            <div class="task-checkbox">
                ${i?"‚úì":""}
            </div>
            <div class="task-content">
                <span class="task-title">${e.title}</span>
                <div class="task-meta">
                    ${r?'<span class="active-badge">‚óâ In Focus</span>':""}
                    ${e.pomodorosCompleted>0?`<span>${e.pomodorosCompleted} üçÖ</span>`:""}
                    ${n?`<span>${n}</span>`:""}
                </div>
            </div>
            <button class="delete-task-btn">√ó</button>
        </div>
      `}}class ue{constructor(e){p(this,"currentReminder","");p(this,"lastChangeTime",0);this.container=e}render(e){if(!e){this.container.innerHTML="",this.currentReminder="";return}const t=Date.now();if(this.currentReminder&&t-this.lastChangeTime<2500)return;const r=["Stretch your neck and shoulders","Close your eyes for 20 seconds","Drink some water","Take a deep breath"];let i=r[Math.floor(Math.random()*r.length)];i===this.currentReminder&&r.length>1&&(i=r[(r.indexOf(i)+1)%r.length]),this.currentReminder=i,this.lastChangeTime=t,this.container.innerHTML=`
      <div class="zen-footer-reminder fade-in">
        <span class="reminder-icon">üçÉ</span>
        <span class="reminder-text">${i}</span>
      </div>
    `}}class he{constructor(){p(this,"ctx",null);p(this,"masterGain",null);p(this,"chimeGain",null);p(this,"tracks",[]);p(this,"activeTrackIndex",0);p(this,"currentAmbienceId","none");p(this,"settings",null);p(this,"CROSSFADE_TIME",1.2)}async init(){if(!this.ctx){this.ctx=new AudioContext,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.chimeGain=this.ctx.createGain(),this.chimeGain.connect(this.masterGain);for(let e=0;e<2;e++){const t=new Audio;t.loop=!0,t.crossOrigin="anonymous";const r=this.ctx.createMediaElementSource(t),i=this.ctx.createGain();i.gain.setValueAtTime(0,this.ctx.currentTime),r.connect(i),i.connect(this.masterGain),this.tracks.push({element:t,source:r,gain:i})}}}async updateSettings(e){if(this.ctx||await this.init(),!this.ctx||!this.masterGain)return;this.settings=e,this.ctx.state==="suspended"&&await this.ctx.resume();const t=e.musicEnabled?e.musicVolume/100:0;this.masterGain.gain.setTargetAtTime(t,this.ctx.currentTime,.1)}async playCue(e){var s;if(!((s=this.settings)!=null&&s.showTransitionChime)||((!this.ctx||!this.chimeGain)&&await this.init(),!this.ctx||!this.chimeGain))return;const t=this.ctx.currentTime,r=this.ctx.createOscillator(),i=this.ctx.createGain();r.type="sine",r.frequency.setValueAtTime(440,t),r.frequency.exponentialRampToValueAtTime(880,t+.1),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.3,t+.05),i.gain.exponentialRampToValueAtTime(.01,t+.5),r.connect(i),i.connect(this.chimeGain),r.start(t),r.stop(t+.5)}async playThemeAmbience(e,t){if(this.ctx||await this.init(),!this.ctx)return;const r=`${e}_${t}`;if(this.currentAmbienceId===r)return;const i=`${e}_${t==="focus"?"focus":"break"}.mp3`,s=chrome.runtime.getURL(`src/assets/audio/${i}`),n=(this.activeTrackIndex+1)%2,a=this.tracks[this.activeTrackIndex],c=this.tracks[n],h=this.ctx.currentTime;a.gain.gain.cancelScheduledValues(h),a.gain.gain.exponentialRampToValueAtTime(.001,h+this.CROSSFADE_TIME),setTimeout(()=>{this.currentAmbienceId!==r&&a.element.pause()},this.CROSSFADE_TIME*1e3),c.element.src=s,c.gain.gain.cancelScheduledValues(h),c.gain.gain.setValueAtTime(.001,h),c.gain.gain.exponentialRampToValueAtTime(1,h+this.CROSSFADE_TIME);try{await c.element.play()}catch{console.warn(`Audio asset missing: ${i}. Please add it to src/assets/audio/`)}this.activeTrackIndex=n,this.currentAmbienceId=r}async stopAmbience(){if(!this.ctx)return;const e=this.ctx.currentTime;this.tracks.forEach(t=>{t.gain.gain.cancelScheduledValues(e),t.gain.gain.exponentialRampToValueAtTime(.001,e+1),setTimeout(()=>t.element.pause(),1e3)}),this.currentAmbienceId="none"}}const Q=document.getElementById("app"),A=new he;if(Q){Q.innerHTML=`
      <div class="zen-layout">
        <header id="header-zone"></header>
        <main id="main-zone">
            <div id="timer-section"></div>
            <div id="tasks-section"></div>
        </main>
        <div id="focus-view"></div>
        <footer id="footer-zone"></footer>
      </div>
    `;const v=new de(document.getElementById("header-zone")),e=new le(document.getElementById("timer-section")),t=new J(document.getElementById("tasks-section")),r=new ue(document.getElementById("footer-zone")),i=document.getElementById("focus-view");let s=null,n=[],a=null,c="list",h=null,m=null;const d=(o,u=2500)=>{let g=document.querySelector(".zen-toast");g||(g=document.createElement("div"),g.className="zen-toast",document.body.appendChild(g)),g.textContent=o,g.classList.remove("show"),g.offsetWidth,g.classList.add("show"),setTimeout(()=>g.classList.remove("show"),u)},f=async()=>{s=await chrome.runtime.sendMessage({type:"GET_STATE"}),n=await b.getTasks(),a=await b.getSettings(),await A.updateSettings(a),T()},T=()=>{if(!s||!a)return;const o=s.isRunning?s.mode==="focus"?"Focusing...":"Resting...":"ZenTask";v.render(o,a.musicEnabled,te,se),r.render(s.mode!=="focus"&&s.isRunning),c==="focus"?x():l(),F(s)},l=()=>{if(!s)return;document.getElementById("main-zone").classList.remove("hidden"),i.classList.remove("active"),e.render(s,a,()=>{chrome.runtime.sendMessage({type:"START_TIMER",payload:{taskId:I()}}).then(()=>{c="focus",h="focus",f(),d("‚ú¶ Focus started")})},()=>chrome.runtime.sendMessage({type:"PAUSE_TIMER"}).then(f),()=>chrome.runtime.sendMessage({type:"SKIP_TIMER"}).then(f),()=>{c="focus",h="focus",T()}),t.render(n,s.activeTaskId,u=>S(u),u=>$(u),u=>{B(u).then(()=>{c="focus",h="focus",f(),d("‚ú¶ Focus started")})},u=>V(u))},x=()=>{var N,O,U,H,Z,W;if(!s||!a)return;document.getElementById("main-zone").classList.add("hidden"),i.classList.add("active");const u=n.find(y=>y.id===s.activeTaskId),g=u?u.title:"Focus";let M="Idle";s.isRunning&&s.mode==="focus"?M=`Focus ¬∑ Cycle ${s.cyclesCompleted+1}`:s.isRunning&&s.mode==="break"?M="Short Break":s.isRunning&&s.mode==="longBreak"?M="Long Rest":s.isRunning||(M="Paused");const w=Math.floor(s.remainingSeconds/60).toString().padStart(2,"0"),k=(s.remainingSeconds%60).toString().padStart(2,"0"),z=150,D=2*Math.PI*z;let C=a.focusDuration*60;s.mode==="break"?C=a.breakDuration*60:s.mode==="longBreak"&&(C=a.longBreakDuration*60);const ie=C>0?s.remainingSeconds/C:0,G=D*(1-ie);if(i.querySelector(".focus-timer-wrap")){const y=i.querySelector("#fv-task-title");y&&(y.textContent=g);const j=i.querySelector("#fv-time");j&&(j.textContent=`${w}:${k}`);const Y=i.querySelector("#fv-state");Y&&(Y.textContent=M);const K=i.querySelector("#fv-ring");K&&K.setAttribute("stroke-dashoffset",String(G))}else{i.innerHTML=`
              <div class="focus-task-title" id="fv-task-title">${g}</div>
              <div class="focus-timer-wrap">
                <svg class="progress-ring" width="320" height="320">
                  <circle class="progress-ring__bg" cx="160" cy="160" r="${z}" />
                  <circle class="progress-ring__fill" id="fv-ring" cx="160" cy="160" r="${z}"
                          stroke-dasharray="${D}" stroke-dashoffset="${G}" />
                </svg>
                <canvas id="focus-visualizer" width="320" height="320"></canvas>
                <div class="focus-time" id="fv-time">${w}:${k}</div>
              </div>
              <div class="focus-state-label" id="fv-state">${M}</div>
              <div class="focus-controls" id="fv-controls"></div>
              <button class="focus-exit-btn" id="fv-exit">‚Üê Exit Focus View</button>
              <button class="focus-show-tasks-btn" id="fv-show-tasks">Show Tasks</button>
            `;const y=i.querySelector("#focus-visualizer");y&&(m=new ee(y),m.start())}m&&m.updateState(s,a);const R=i.querySelector("#fv-controls");R&&(s.isRunning?R.innerHTML=`
                  <button class="btn-primary" id="fv-pause">Pause</button>
                  <button class="btn-secondary" id="fv-skip" style="padding:10px 14px;">‚è≠</button>
                `:R.innerHTML=`
                  <button class="btn-primary" id="fv-resume">Resume</button>
                  <button class="btn-danger" id="fv-stop">Stop</button>
                  <button class="btn-secondary" id="fv-skip" style="padding:10px 14px;">‚è≠</button>
                `,(N=R.querySelector("#fv-pause"))==null||N.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"PAUSE_TIMER"}).then(f)}),(O=R.querySelector("#fv-resume"))==null||O.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"START_TIMER",payload:{taskId:I()}}).then(f)}),(U=R.querySelector("#fv-stop"))==null||U.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"RESET_TIMER"}).then(()=>{E()})}),(H=R.querySelector("#fv-skip"))==null||H.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"SKIP_TIMER"}).then(f)}));const P=i.querySelector("#fv-exit");if(P){const y=P.cloneNode(!0);(Z=P.parentNode)==null||Z.replaceChild(y,P),y.addEventListener("click",()=>E())}const _=i.querySelector("#fv-show-tasks");if(_){const y=_.cloneNode(!0);(W=_.parentNode)==null||W.replaceChild(y,_),y.addEventListener("click",()=>q())}},E=()=>{c="list",h=null,m&&(m.stop(),m=null),i.innerHTML="",f()},q=()=>{if(!s)return;const o=document.createElement("div");o.className="task-drawer-overlay";const u=document.createElement("div");u.className="task-drawer";const g=document.createElement("div");new J(g).render(n,s.activeTaskId,k=>{S(k),w()},k=>{$(k),w()},k=>{B(k),w()},k=>{V(k),w()}),u.appendChild(g),document.body.appendChild(o),document.body.appendChild(u),requestAnimationFrame(()=>{o.classList.add("visible"),u.classList.add("open")});const w=()=>{u.classList.remove("open"),o.classList.remove("visible"),setTimeout(()=>{o.remove(),u.remove(),f()},350)};o.addEventListener("click",w)},L=o=>{if(!h||!a){h=o.mode;return}o.mode!==h&&(o.mode==="focus"&&(h==="break"||h==="longBreak")?d("‚ú¶ Back to focus"):(o.mode==="break"||o.mode==="longBreak")&&(d("üåø Break time"),a.autoReturnToListOnBreak&&c==="focus"&&E()),h=o.mode)},I=()=>s==null?void 0:s.activeTaskId,S=async o=>{const u={id:crypto.randomUUID(),title:o,isCompleted:!1,estimatedMinutes:25,createdAt:Date.now(),order:n.length,totalTimeMs:0,sessionTimeMs:0,pomodorosCompleted:0};n.push(u),await b.saveTasks(n),f()},$=async o=>{const u=n.find(g=>g.id===o);u&&(u.isCompleted=!u.isCompleted,await b.saveTasks(n),f())},B=async o=>{s!=null&&s.isRunning&&await chrome.runtime.sendMessage({type:"PAUSE_TIMER"}),await chrome.runtime.sendMessage({type:"START_TIMER",payload:{taskId:o}})},V=async o=>{(s==null?void 0:s.activeTaskId)===o&&s.isRunning&&await chrome.runtime.sendMessage({type:"PAUSE_TIMER"}),n=n.filter(u=>u.id!==o),await b.saveTasks(n),f()},te=async()=>{a||(a=await b.getSettings());const o=!a.musicEnabled;a={...a,musicEnabled:o},await b.saveSettings(a),await A.updateSettings(a),o?s&&await F(s):await A.stopAmbience(),T()},se=()=>{ce(async()=>{const{SettingsPanel:o}=await import("./SettingsModal.js");return{SettingsPanel:o}},__vite__mapDeps([0,1])).then(({SettingsPanel:o})=>{new o(()=>f()).open()})},F=async o=>{if(a||(a=await b.getSettings()),!a.musicEnabled){await A.stopAmbience();return}o.isRunning?await A.playThemeAmbience(a.theme,o.mode):await A.stopAmbience()};f(),b.onChange(o=>{o.zen_settings&&f()}),chrome.runtime.onMessage.addListener(o=>{if(o.type==="TIMER_UPDATE"){const u=o.payload;L(u),s=u,T()}else o.type==="PLAY_CUE"&&A.playCue(o.payload)}),window.addEventListener("mousemove",o=>{m&&m.updateMouse(o.clientX,o.clientY)})}
