const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SettingsModal.js","assets/storage.js"])))=>i.map(i=>d[i]);
var ie=Object.defineProperty;var ae=(v,e,t)=>e in v?ie(v,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):v[e]=t;var f=(v,e,t)=>ae(v,typeof e!="symbol"?e+"":e,t);import"./main.js";import{S as x}from"./storage.js";const oe="modulepreload",re=function(v){return"/"+v},J={},ce=function(e,t,a){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),s=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(t.map(c=>{if(c=re(c),c in J)return;J[c]=!0;const n=c.endsWith(".css"),m=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const l=document.createElement("link");if(l.rel=n?"stylesheet":oe,n||(l.as="script"),l.crossOrigin="",l.href=c,s&&l.setAttribute("nonce",s),document.head.appendChild(l),n)return new Promise((g,p)=>{l.addEventListener("load",g),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function h(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return o.then(i=>{for(const s of i||[])s.status==="rejected"&&h(s.reason);return e().catch(h)})};class de{constructor(e){this.container=e}render(e,t,a){var h,i;const o=`theme-${e.theme}`;this.container.innerHTML=`
      <div class="zen-header ${o}">
        <div class="header-left"></div>
        <div class="header-center">
          <span class="logo">
            <span class="logo-icon">‚òØ</span>
            <span class="logo-text">ZenTask</span>
          </span>
        </div>
        <div class="header-right">
          <button id="sound-toggle" class="icon-btn" title="${e.musicEnabled?"Mute":"Unmute"}">
            <svg class="zen-icon" viewBox="0 0 24 24">
              ${e.musicEnabled?'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>':'<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>'}
            </svg>
          </button>
          <button id="settings-btn" class="icon-btn" title="Settings">
            <svg class="zen-icon" viewBox="0 0 24 24">
              <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
            </svg>
          </button>
        </div>
      </div>
    `,(h=this.container.querySelector("#sound-toggle"))==null||h.addEventListener("click",t),(i=this.container.querySelector("#settings-btn"))==null||i.addEventListener("click",a)}}class le{constructor(e){this.container=e}render(e,t,a,o,h){var c;const i=Math.floor(e.remainingSeconds/60).toString().padStart(2,"0"),s=(e.remainingSeconds%60).toString().padStart(2,"0");if(!this.container.querySelector(".timer-container"))this.container.innerHTML=`
        <div class="timer-container" style="position:relative; width:300px; height:300px; cursor: pointer;">
          <div style="position:relative; z-index:1; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;">
            <div class="timer-time" id="time-display">${i}:${s}</div>

            <div class="timer-controls">
              <button id="main-action-btn" class="btn-primary">
                ${e.isRunning?"Pause":"Start Focus"}
              </button>
              <button id="skip-btn" class="btn-secondary" style="padding:10px 14px;">‚è≠</button>
            </div>

            <div class="status-indicator" id="status-text">${this.getStatusText(e)}</div>
          </div>
        </div>
      `,(c=this.container.querySelector(".timer-container"))==null||c.addEventListener("click",n=>{n.target.tagName.toLowerCase()!=="button"&&h()});else{const n=this.container.querySelector("#time-display");n&&(n.textContent=`${i}:${s}`,n.classList.remove("focus-glow","break-glow"),e.isRunning&&e.mode==="focus"?n.classList.add("focus-glow"):e.isRunning&&n.classList.add("break-glow"));const m=this.container.querySelector("#status-text");m&&(m.textContent=this.getStatusText(e))}this.bindButton("#main-action-btn",e.isRunning?"Pause":"Start Focus",n=>{n.stopPropagation(),e.isRunning?a():t()}),this.bindButton("#skip-btn",void 0,n=>{n.stopPropagation(),o()})}getStatusText(e){return e.mode==="focus"?`Focus ¬∑ Cycle ${e.cyclesCompleted+1}`:e.mode==="break"?"Short Break":e.mode==="longBreak"?"Long Rest":"Ready"}bindButton(e,t,a){var i;const o=this.container.querySelector(e);if(!o)return;t!==void 0&&(o.textContent=t);const h=o.cloneNode(!0);(i=o.parentNode)==null||i.replaceChild(h,o),h.addEventListener("click",a)}}class Q{constructor(e){this.container=e}render(e,t,a,o,h,i){const s=[...e].sort((l,g)=>l.id===t?-1:g.id===t?1:(l.order||0)-(g.order||0));this.container.innerHTML=`
      <div class="task-list-panel">
        <div class="tasks-header">
            <span>Today's Cycle</span>
            <span style="font-size:0.8em;opacity:0.7">${e.filter(l=>l.isCompleted).length}/${e.length}</span>
        </div>

        <div class="task-list">
          ${s.length===0?'<div class="empty-state">Focus on one thing at a time.</div>':s.map(l=>this.renderTaskRow(l,t)).join("")}
        </div>
        
        <div class="task-input-container">
            <input type="text" id="new-task-input" class="task-input" placeholder="What is your next focus?" />
            <button id="add-task-btn" class="btn-secondary" style="padding:10px 16px;">+</button>
        </div>
      </div>
    `;const c=this.container.querySelector("#new-task-input"),n=this.container.querySelector("#add-task-btn"),m=()=>{c.value.trim()&&(a(c.value.trim()),c.value="")};n==null||n.addEventListener("click",m),c==null||c.addEventListener("keypress",l=>{l.key==="Enter"&&m()}),this.container.querySelectorAll(".task-item").forEach(l=>{var p,d;const g=l.dataset.id;(p=l.querySelector(".task-checkbox"))==null||p.addEventListener("click",b=>{b.stopPropagation(),o(g)}),(d=l.querySelector(".delete-task-btn"))==null||d.addEventListener("click",b=>{b.stopPropagation(),i(g)}),l.addEventListener("click",()=>{!l.classList.contains("completed")&&g!==t&&h(g)})})}renderTaskRow(e,t){const a=e.id===t,o=e.isCompleted,h=Math.floor((e.totalTimeMs||0)/6e4),i=h>0?`${Math.floor(h/60)}h ${h%60}m`:"";return`
        <div class="task-item ${a?"active":""} ${o?"completed":""}" data-id="${e.id}">
            <div class="task-checkbox">
                ${o?"‚úì":""}
            </div>
            <div class="task-content">
                <span class="task-title">${e.title}</span>
                <div class="task-meta">
                    ${a?'<span class="active-badge">‚óâ In Focus</span>':""}
                    ${e.pomodorosCompleted>0?`<span>${e.pomodorosCompleted} üçÖ</span>`:""}
                    ${i?`<span>${i}</span>`:""}
                </div>
            </div>
            <button class="delete-task-btn">√ó</button>
        </div>
      `}}class ue{constructor(e){f(this,"currentReminder","");f(this,"lastChangeTime",0);this.container=e}render(e){if(!e){this.container.innerHTML="",this.currentReminder="";return}const t=Date.now();if(this.currentReminder&&t-this.lastChangeTime<2500)return;const a=["Stretch your neck and shoulders","Close your eyes for 20 seconds","Drink some water","Take a deep breath"];let o=a[Math.floor(Math.random()*a.length)];o===this.currentReminder&&a.length>1&&(o=a[(a.indexOf(o)+1)%a.length]),this.currentReminder=o,this.lastChangeTime=t,this.container.innerHTML=`
      <div class="zen-footer-reminder fade-in">
        <span class="reminder-icon">üçÉ</span>
        <span class="reminder-text">${o}</span>
      </div>
    `}}class he{constructor(){f(this,"ctx",null);f(this,"masterGain",null);f(this,"chimeGain",null);f(this,"tracks",[]);f(this,"activeTrackIndex",0);f(this,"currentAmbienceId","none");f(this,"settings",null);f(this,"CROSSFADE_TIME",1.2);f(this,"REMOTE_FALLBACKS",{forest_focus:"https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Forest+Ambience&filename=24/246473-cb378298-2921-4f6c-8438-e67c870c52bb.mp3",forest_break:"https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Wind+in+trees&filename=24/246473-7e4e1f74-32b4-4b5a-9407-3a1b0c0343a4.mp3",rain_focus:"https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Heavy+Rain&filename=24/246473-61fc0f8d-c782-4c2e-9d8a-9e1e3b6e8a8b.mp3",rain_break:"https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Soft+Rain&filename=24/246473-b3c1d4e5-f6a7-4b8c-9e0a-1d2e3f4a5b6c.mp3",summer_focus:"https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Cicadas&filename=24/246473-d5e6f7a8-b9c0-4d1e-8f2a-3b4c5d6e7f8a.mp3",summer_break:"https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Birds+Singing&filename=24/246473-1a2b3c4d-5e6f-4a8c-9e0d-1f2e3a4b5c6d.mp3",space_focus:"https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Deep+Space&filename=24/246473-8a9b0c1d-2e3f-4a5b-6c7d-8e9f0a1b2c3d.mp3",space_break:"https://assets.mixkit.co/sfx/preview/mixkit-meditation-bowl-single-hit-2090.mp3"})}async init(){if(!this.ctx){this.ctx=new AudioContext,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.chimeGain=this.ctx.createGain(),this.chimeGain.connect(this.masterGain);for(let e=0;e<2;e++){const t=new Audio;t.loop=!0,t.crossOrigin="anonymous";const a=this.ctx.createMediaElementSource(t),o=this.ctx.createGain();o.gain.setValueAtTime(0,this.ctx.currentTime),a.connect(o),o.connect(this.masterGain),this.tracks.push({element:t,source:a,gain:o})}}}async resume(){this.ctx&&this.ctx.state==="suspended"&&await this.ctx.resume()}async updateSettings(e){if(this.ctx||await this.init(),!this.ctx||!this.masterGain)return;this.settings=e,this.ctx.state==="suspended"&&await this.ctx.resume();const t=e.musicEnabled?e.musicVolume/100:0;this.masterGain.gain.setTargetAtTime(t,this.ctx.currentTime,.1)}async playCue(e){var h;if(!((h=this.settings)!=null&&h.showTransitionChime)||((!this.ctx||!this.chimeGain)&&await this.init(),!this.ctx||!this.chimeGain))return;const t=this.ctx.currentTime,a=this.ctx.createOscillator(),o=this.ctx.createGain();a.type="sine",a.frequency.setValueAtTime(440,t),a.frequency.exponentialRampToValueAtTime(880,t+.1),o.gain.setValueAtTime(0,t),o.gain.linearRampToValueAtTime(.3,t+.05),o.gain.exponentialRampToValueAtTime(.01,t+.5),a.connect(o),o.connect(this.chimeGain),a.start(t),a.stop(t+.5)}async playThemeAmbience(e,t){if(this.ctx||await this.init(),!this.ctx)return;const a=`${e}_${t}`;if(this.currentAmbienceId===a)return;const o=`${e}_${t==="focus"?"focus":"break"}.mp3`,h=chrome.runtime.getURL(`src/assets/audio/${o}`),i=this.REMOTE_FALLBACKS[a],s=(this.activeTrackIndex+1)%2,c=this.tracks[this.activeTrackIndex],n=this.tracks[s],m=this.ctx.currentTime,l=g=>new Promise((p,d)=>{n.element.src=g,n.element.oncanplaythrough=async()=>{n.element.oncanplaythrough=null,c.gain.gain.cancelScheduledValues(m),c.gain.gain.exponentialRampToValueAtTime(.001,m+this.CROSSFADE_TIME),setTimeout(()=>c.element.pause(),this.CROSSFADE_TIME*1e3),n.gain.gain.cancelScheduledValues(m),n.gain.gain.setValueAtTime(.001,m),n.gain.gain.exponentialRampToValueAtTime(1,m+this.CROSSFADE_TIME);try{await n.element.play(),p()}catch(b){d(b)}},n.element.onerror=b=>d(b),n.element.load()});try{await l(h)}catch{console.log(`Local asset ${o} missing or blocked, trying remote...`);try{i&&await l(i)}catch{console.warn(`All attempts failed for ${a}`)}}this.activeTrackIndex=s,this.currentAmbienceId=a}async stopAmbience(){if(!this.ctx)return;const e=this.ctx.currentTime;this.tracks.forEach(t=>{t.gain.gain.cancelScheduledValues(e),t.gain.gain.exponentialRampToValueAtTime(.001,e+1),setTimeout(()=>t.element.pause(),1e3)}),this.currentAmbienceId="none"}}class me{constructor(e){f(this,"ctx");f(this,"animationId",0);f(this,"state",null);f(this,"settings",null);f(this,"theme","forest");f(this,"phase",0);f(this,"currentSpeedMult",1);f(this,"currentAlphaMult",1);f(this,"TRANSITION_LERP",.05);f(this,"particles",[]);f(this,"ripples",[]);f(this,"mouse",{x:0,y:0,active:!1});f(this,"prefersReducedMotion",!1);f(this,"animate",()=>{this.render(),this.animationId=requestAnimationFrame(this.animate)});this.canvas=e,this.ctx=e.getContext("2d"),this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.initParticles()}start(){this.animate()}stop(){cancelAnimationFrame(this.animationId)}updateState(e,t){this.state=e,this.settings=t,this.theme!==t.theme&&(this.theme=t.theme,this.initParticles())}updateMouse(e,t){var a;this.prefersReducedMotion||!((a=this.settings)!=null&&a.backgroundInteractions)||(this.mouse.x=e,this.mouse.y=t,this.mouse.active=!0,this.theme==="rain"&&Math.random()>.8&&this.ripples.push({x:e,y:t,r:0,life:1}))}initParticles(){this.particles=[];const e=this.theme==="space"?120:60,t=this.canvas.width,a=this.canvas.height;for(let o=0;o<e;o++)this.particles.push({x:Math.random()*t,y:Math.random()*a,r:Math.random()*2.5+.5,vx:(Math.random()-.5)*.4,vy:(Math.random()-.5)*.4,baseDist:Math.random()*200+100,angle:Math.random()*Math.PI*2,opacity:Math.random()*.4+.1})}render(){var l,g,p;if(!this.canvas)return;const e=this.canvas.width,t=this.canvas.height,a=e/2,o=t/2;this.ctx.clearRect(0,0,e,t);const i={forest:{r:90,g:180,b:110},rain:{r:100,g:170,b:230},summer:{r:240,g:190,b:100},space:{r:150,g:100,b:240}}[this.theme];let s=1,c=1;(l=this.state)!=null&&l.isRunning&&(s=this.state.mode==="focus"?1.4:.7,c=this.state.mode==="focus"?1.3:.6),(g=this.settings)!=null&&g.backgroundTransitions?(this.currentSpeedMult+=(s-this.currentSpeedMult)*this.TRANSITION_LERP,this.currentAlphaMult+=(c-this.currentAlphaMult)*this.TRANSITION_LERP):(this.currentSpeedMult=s,this.currentAlphaMult=c);const n=.012*this.currentSpeedMult;this.prefersReducedMotion||(this.phase+=n),this.drawCore(e,t,i,this.currentAlphaMult),this.theme==="rain"&&(this.ripples=this.ripples.filter(d=>d.life>0),this.ripples.forEach(d=>{d.r+=3,d.life-=.015,this.ctx.strokeStyle=`rgba(${i.r}, ${i.g}, ${i.b}, ${d.life*.3})`,this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.arc(d.x,d.y,d.r,0,Math.PI*2),this.ctx.stroke()}));const m=((p=this.settings)==null?void 0:p.backgroundInteractions)&&!this.prefersReducedMotion;this.particles.forEach(d=>{d.x+=d.vx*this.currentSpeedMult,d.y+=d.vy*this.currentSpeedMult,d.x<0&&(d.x=e),d.x>e&&(d.x=0),d.y<0&&(d.y=t),d.y>t&&(d.y=0);let b=d.x,R=d.y;if(m){const I=this.mouse.x-d.x,C=this.mouse.y-d.y,T=Math.sqrt(I*I+C*C);if(this.theme==="space"){if(T<200){const $=(200-T)*.04;b-=I/T*$,R-=C/T*$}}else this.theme==="forest"||this.theme==="rain"?(b+=(this.mouse.x-a)*.01*d.r,R+=(this.mouse.y-o)*.01*d.r):this.theme==="summer"&&T<150&&(d.vx+=(Math.random()-.5)*.05,d.vy-=.03)}const A=(d.opacity||.5)*this.currentAlphaMult;this.ctx.fillStyle=`rgba(${i.r}, ${i.g}, ${i.b}, ${A})`,this.ctx.beginPath(),this.ctx.arc(b,R,d.r,0,Math.PI*2),this.ctx.fill()})}drawCore(e,t,a,o){const h=e/2,i=t/2,s=Math.max(e,t)*.8,c=this.mouse.active?(this.mouse.x-h)*.03:0,n=this.mouse.active?(this.mouse.y-i)*.03:0,m=this.ctx.createRadialGradient(h+c,i+n,0,h+c,i+n,s);m.addColorStop(0,`rgba(${a.r}, ${a.g}, ${a.b}, ${.12*o})`),m.addColorStop(1,"rgba(0,0,0,0)"),this.ctx.fillStyle=m,this.ctx.fillRect(0,0,e,t)}}const ee=document.getElementById("app"),E=new he;if(ee){ee.innerHTML=`
      <div class="zen-layout">
        <canvas id="zen-background" class="zen-bg-canvas"></canvas>
        <header id="header-zone"></header>
        <main id="main-zone">
            <div id="timer-section"></div>
            <div id="tasks-section"></div>
        </main>
        <div id="focus-view"></div>
        <footer id="footer-zone"></footer>
      </div>
    `;const v=document.getElementById("zen-background"),e=new me(v);e.start(),window.addEventListener("resize",()=>{v.width=window.innerWidth,v.height=window.innerHeight}),window.dispatchEvent(new Event("resize"));const t=new de(document.getElementById("header-zone")),a=new le(document.getElementById("timer-section")),o=new Q(document.getElementById("tasks-section")),h=new ue(document.getElementById("footer-zone")),i=document.getElementById("focus-view");let s=null,c=[],n=null,m="list",l=null;const g=(r,u=2500)=>{let y=document.querySelector(".zen-toast");y||(y=document.createElement("div"),y.className="zen-toast",document.body.appendChild(y)),y.textContent=r,y.classList.remove("show"),y.offsetWidth,y.classList.add("show"),setTimeout(()=>y.classList.remove("show"),u)},p=async()=>{s=await chrome.runtime.sendMessage({type:"GET_STATE"}),c=await x.getTasks(),n=await x.getSettings(),await E.updateSettings(n),d()},d=()=>{!s||!n||(t.render(n,te,se),h.render(s.mode!=="focus"&&s.isRunning),m==="focus"?R():b(),e.updateState(s,n),F(s))},b=()=>{if(!s)return;document.getElementById("main-zone").classList.remove("hidden"),i.classList.remove("active"),a.render(s,()=>{chrome.runtime.sendMessage({type:"START_TIMER",payload:{taskId:T()}}).then(()=>{m="focus",l="focus",p(),g("‚ú¶ Focus started")})},()=>chrome.runtime.sendMessage({type:"PAUSE_TIMER"}).then(p),()=>chrome.runtime.sendMessage({type:"SKIP_TIMER"}).then(p),()=>{m="focus",l="focus",d()}),o.render(c,s.activeTaskId,u=>$(u),u=>B(u),u=>{D(u).then(()=>{m="focus",l="focus",p(),g("‚ú¶ Focus started")})},u=>V(u))},R=()=>{var O,U,N,W,Z,K;if(!s||!n)return;document.getElementById("main-zone").classList.add("hidden"),i.classList.add("active");const u=c.find(k=>k.id===s.activeTaskId),y=u?u.title:"Focus";let M="Idle";s.isRunning&&s.mode==="focus"?M=`Focus ¬∑ Cycle ${s.cyclesCompleted+1}`:s.isRunning&&s.mode==="break"?M="Short Break":s.isRunning&&s.mode==="longBreak"?M="Long Rest":s.isRunning||(M="Paused");const S=Math.floor(s.remainingSeconds/60).toString().padStart(2,"0"),w=(s.remainingSeconds%60).toString().padStart(2,"0"),q=150,G=2*Math.PI*q;let _=n.focusDuration*60;s.mode==="break"?_=n.breakDuration*60:s.mode==="longBreak"&&(_=n.longBreakDuration*60);const ne=_>0?s.remainingSeconds/_:0,H=G*(1-ne);if(!i.querySelector(".focus-timer-wrap"))i.innerHTML=`
              <div class="focus-task-title" id="fv-task-title">${y}</div>
              <div class="focus-timer-wrap">
                <svg class="progress-ring" width="320" height="320">
                  <circle class="progress-ring__bg" cx="160" cy="160" r="${q}" />
                  <circle class="progress-ring__fill" id="fv-ring" cx="160" cy="160" r="${q}"
                          stroke-dasharray="${G}" stroke-dashoffset="${H}" />
                </svg>
                <div class="focus-time" id="fv-time">${S}:${w}</div>
              </div>
              <div class="focus-state-label" id="fv-state">${M}</div>
              <div class="focus-controls" id="fv-controls"></div>
              <button class="focus-exit-btn" id="fv-exit">‚Üê Exit Focus View</button>
              <button class="focus-show-tasks-btn" id="fv-show-tasks">Show Tasks</button>
            `,i.querySelector("#focus-visualizer");else{const k=i.querySelector("#fv-task-title");k&&(k.textContent=y);const Y=i.querySelector("#fv-time");Y&&(Y.textContent=`${S}:${w}`);const j=i.querySelector("#fv-state");j&&(j.textContent=M);const X=i.querySelector("#fv-ring");X&&X.setAttribute("stroke-dashoffset",String(H))}const L=i.querySelector("#fv-controls");L&&(s.isRunning?L.innerHTML=`
                  <button class="btn-primary" id="fv-pause">Pause</button>
                  <button class="btn-secondary" id="fv-skip" style="padding:10px 14px;">‚è≠</button>
                `:L.innerHTML=`
                  <button class="btn-primary" id="fv-resume">Resume</button>
                  <button class="btn-danger" id="fv-stop">Stop</button>
                  <button class="btn-secondary" id="fv-skip" style="padding:10px 14px;">‚è≠</button>
                `,(O=L.querySelector("#fv-pause"))==null||O.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"PAUSE_TIMER"}).then(p)}),(U=L.querySelector("#fv-resume"))==null||U.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"START_TIMER",payload:{taskId:T()}}).then(p)}),(N=L.querySelector("#fv-stop"))==null||N.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"RESET_TIMER"}).then(()=>{A()})}),(W=L.querySelector("#fv-skip"))==null||W.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"SKIP_TIMER"}).then(p)}));const P=i.querySelector("#fv-exit");if(P){const k=P.cloneNode(!0);(Z=P.parentNode)==null||Z.replaceChild(k,P),k.addEventListener("click",()=>A())}const z=i.querySelector("#fv-show-tasks");if(z){const k=z.cloneNode(!0);(K=z.parentNode)==null||K.replaceChild(k,z),k.addEventListener("click",()=>I())}},A=()=>{m="list",l=null,i.innerHTML="",p()},I=()=>{if(!s)return;const r=document.createElement("div");r.className="task-drawer-overlay";const u=document.createElement("div");u.className="task-drawer";const y=document.createElement("div");new Q(y).render(c,s.activeTaskId,w=>{$(w),S()},w=>{B(w),S()},w=>{D(w),S()},w=>{V(w),S()}),u.appendChild(y),document.body.appendChild(r),document.body.appendChild(u),requestAnimationFrame(()=>{r.classList.add("visible"),u.classList.add("open")});const S=()=>{u.classList.remove("open"),r.classList.remove("visible"),setTimeout(()=>{r.remove(),u.remove(),p()},350)};r.addEventListener("click",S)},C=r=>{if(!l||!n){l=r.mode;return}r.mode!==l&&(r.mode==="focus"&&(l==="break"||l==="longBreak")?g("‚ú¶ Back to focus"):(r.mode==="break"||r.mode==="longBreak")&&(g("üåø Break time"),n.autoReturnToListOnBreak&&m==="focus"&&A()),l=r.mode)},T=()=>s==null?void 0:s.activeTaskId,$=async r=>{const u={id:crypto.randomUUID(),title:r,isCompleted:!1,estimatedMinutes:25,createdAt:Date.now(),order:c.length,totalTimeMs:0,sessionTimeMs:0,pomodorosCompleted:0};c.push(u),await x.saveTasks(c),p()},B=async r=>{const u=c.find(y=>y.id===r);u&&(u.isCompleted=!u.isCompleted,await x.saveTasks(c),p())},D=async r=>{s!=null&&s.isRunning&&await chrome.runtime.sendMessage({type:"PAUSE_TIMER"}),await chrome.runtime.sendMessage({type:"START_TIMER",payload:{taskId:r}})},V=async r=>{(s==null?void 0:s.activeTaskId)===r&&s.isRunning&&await chrome.runtime.sendMessage({type:"PAUSE_TIMER"}),c=c.filter(u=>u.id!==r),await x.saveTasks(c),p()},te=async()=>{n||(n=await x.getSettings());const r=!n.musicEnabled;n={...n,musicEnabled:r},await x.saveSettings(n),await E.updateSettings(n),r?s&&await F(s):await E.stopAmbience(),d()},se=()=>{ce(async()=>{const{SettingsPanel:r}=await import("./SettingsModal.js");return{SettingsPanel:r}},__vite__mapDeps([0,1])).then(({SettingsPanel:r})=>{new r(()=>p()).open()})},F=async r=>{if(n||(n=await x.getSettings()),!n.musicEnabled){await E.stopAmbience();return}r.isRunning?await E.playThemeAmbience(n.theme,r.mode):await E.stopAmbience()};p(),x.onChange(r=>{r.zen_settings&&p()}),chrome.runtime.onMessage.addListener(r=>{if(r.type==="TIMER_UPDATE"){const u=r.payload;C(u),s=u,d()}else r.type==="PLAY_CUE"&&E.playCue(r.payload)}),window.addEventListener("mousemove",r=>{e.updateMouse(r.clientX,r.clientY)}),window.addEventListener("click",()=>{E.resume()},{once:!0})}
